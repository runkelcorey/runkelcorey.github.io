<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.40">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Corey Runkel">
<meta name="dcterms.date" content="2022-04-21">

<title>Farmington Canal Trail Bike Century – Corey</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-70d37b45c5086134dc26dbb10e888fc0.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap-29ae748a7db3d513bee5d843ea35727a.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


</head>

<body class="nav-fixed fullcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Corey</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../about.html"> 
<span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/runkelcorey"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/platopasta"> <i class="bi bi-twitter" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Farmington Canal Trail Bike Century</h1>
                                <div class="quarto-categories">
                <div class="quarto-category">fitness</div>
                <div class="quarto-category">cycling</div>
                <div class="quarto-category">new haven</div>
                <div class="quarto-category">bucket list</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>Corey Runkel </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">April 21, 2022</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">





<p>I learned to ride a bike just before I moved to New Haven. Living in a city, abandoning my boring, dangerous, radio-less car seemed like a great statement to make about myself and the world I wanted to see. Unfortunately, Amtrak is <em>expensive</em> and getting to the White Mountains is pretty hard without a car.</p>
<p>Still, I became the cyclist I hoped to be: if the roads are dry, I bike. I’ve assembled the lobster gloves, under-helmet hats, and merino wool that make windchills in the single digits tolerable. And I try to limit my car trips to groceries and Boston (where the ol’ partner lives). But more than a statement about my identity, I like to bike because it gives me joy that I missed out on in childhood.</p>
<p>Moreover, life in New Haven got a lot better when I found the Farmington Canal Trail in the covid summer of 2020. Running 65 miles from New Haven to Northampton, the trail is a piece of functional history; a railroad and, before that, a canal, a few historical locks still line its sides. I’d taken the trail on a cocxyx-shattering 46-mile ride last year, but never ventured past Southington, CT, where the trail peters out and cyclists must brave the road to catch the northern section up to Massachussetts. I nearly passed out that day from low energy, but it didn’t diminish my goal to one day cycle the whole thing.</p>
<p>I decided to add a bunch and make it an even 100 miles—a proper <em>century</em>—to satisfy my list-obsessed brain. And to make it easier on myself, I decided to stop along the route often, to stretch and enjoy the delights of New England. Weirdly, not a whole lot of online types seem to have done this route from New Haven, so I’m sharing my journey here.</p>
<section id="route" class="level2">
<h2 class="anchored" data-anchor-id="route">Route</h2>
<p>Helen Hadley Hall, the [current] southern terminus, to Westfield is 65 miles, leaving 35 miles of choices for the route-setter. The 5-6 mile Farmington River Trail spur was an easy choice to make. It cuts through the charming towns of Collinsville and Canton, and gives the cyclists quaint views of a fast-moving river.</p>
<p>On the Massachussetts end, cyclists are confronted with the paved end of the trail in Westfield, short of the original canal. We had debated continuing to Northampton, and the Norwottuck Rail Trail, before getting a friend with a bike rack to drive us to the Springfield Amtrak station, but it was too hard to coordinate. It was disappointing to miss this because Northampton has a great beer and food culture, and connecting rail trail would have kept us in pastoral surrounds and off roads for longer. We ultimately decided to make a u-turn at Westfield, hang a left at Simsbury, and bike to Hartford, where we caught the train.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
A note about trains
</div>
</div>
<div class="callout-body-container callout-body">
<p>Cycling up to Northampton and then taking a u-turn back to Springfield could have worked if the train schedules aligned. However, CTrail only ran<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> two trains from Springfield, one at 5:30p and one at 9:45p, so if you miss one you’re stuck until dark.</p>
<p>Ending in Hartford was a much more robust option, even if it sacrificed a bit of beauty and some safety; both CTrail and Amtrak serve the Hartford–New Haven route more frequently (in fact, all trains that run from Northampton stop at Hartford) and, when we went, both 4p and 5:45p CTrail trains served New Haven. Using CTrail was important because: 1. They don’t cap the number of bikes aboard 2. Bikes ride free 3. Ticket prices don’t fluctuate These features gave us flexbility to miss one train and take the next.</p>
</div>
</div>
<p>This route involved 80% paved trail, 3% cinder/packed dirt/gravel trail, 15% sharrow roads, and 2% roads with bike lanes or large shoulders. I felt uneasy on the sharrow roads because cars were going 50 or 60mph around us, though this part of Connecticut is accustomed to bike traffic. A 1 mile section between the Southern and Northern sections of the trail was straight up not fun—3 lanes of traffic, constant turnoffs for businesses, people entering the interstate, several stoplights, and glass all over the roadway—and, to make it worse, we had to make a left turn out of that street. And the last 9 miles into Hartford are all on roads; the shoulder starts big (bigger than a bike lane), which you will need for the 300ft climb over Talcott Mountain. You are rewarded by an equally long descent, which we sent at 40mph, and rolling hills that gradually drop you 450ft. Here, the shoulder narrows considerably, to a width of 2ft at many points. We averaged 20-25mph there, and the road is well-paved with little debris, but I was on high alert nonetheless.</p>
<p>Luckily, I had plenty of bandwidth to stay alert on these sections because of all the carefree miles. After Hamden, there’s probably 10 cumulative miles of bumpy trail. Being the route of an historical canal, it’s unbelievably flat. There are <em>no</em> sections on the trail that require climbing a grade higher than 2% for more than 1 minute.</p>
</section>
<section id="prep" class="level2">
<h2 class="anchored" data-anchor-id="prep">Prep</h2>
<p>I ate a ton and drank no alcohol for the 4 days leading up to this ride. I rested the day before, but otherwise didn’t exercise any differently than usual. I continued biking to work 3-4 days a week. And, maybe a month ago, I rode 20 miles? In any case, my last proper long ride was the 46-miler last year. I think this is actually quite an important difference between me and people who pull out their bike once a month, but it shows you how accessible 100 miles can be.</p>
</section>
<section id="stops" class="level2">
<h2 class="anchored" data-anchor-id="stops">Stops</h2>
<p>Despite my grand ambitions of breweries and fine dining, we only stopped twice for more than 10 minutes, at Red’s Café in Southwick, MA and Janik’s Pierogi Café in Westfield. I’m pretty ambivalent about Red’s, but huge on Janik’s. Red’s advertised as being bike friendly, which is always nice. They have beautiful floors yet somehow don’t care about all the bike shoes coming in. But, their espresso was sub-sub-par; I bought a great croissant from them, but one croissant a café does not make.</p>
<p>Janik’s was not super high on us bringing our bikes in, but I think the purveyor saw the empty restaurant and re-thought her strategy. I think they could do well advertising for bikers because they’re no more than 200ft from the trail (also their floors aren’t anything special). Moreover, their pierogis are filling and their smoothies refreshing. My coworker, who joined me on the ride, bought some cute Polish tchotchkes that he could stick in his frame bag.</p>
<p>We stopped to pee <strong>a lot</strong> and I recommend thinking outside those, where you’ll be rewarded with fisher spots down by the river, beautiful wooded meadows, etc. To poop, your options are Cheshire, which is 14 miles in, or a restaurant, unless Shallow Brook State Park (~ 45 miles up) opens their restrooms. I felt that there must be something in Simsbury, since the rest of the bike infrastructure was so great, but we couldn’t spot anything from the trail. If this is true, it’s a big oversight.</p>
</section>
<section id="gear" class="level2">
<h2 class="anchored" data-anchor-id="gear">Gear</h2>
<p>I try to resist bike gear as much as possible. Every piece is expensive and so specialized that I usually can’t use it for more than one function. If that’s you, then borrow, borrow, borrow! At the very least you’ll learn what is useful and what’s not.</p>
<p>I took the following: * saddle bag + spare tube + tire levers + patch kit + phone + ID + money + mask + wireless earbuds * frame + squeezable water bottle + pedal clips * me + jersey + arm warmers + biking jacket + biking sunglasses + bib shorts + windproof gloves + helmet!</p>
<p>My friend added: * frame pump * phone mount, which we needed for directions on the road sections</p>
<p>Of these, I purchased clips ($5 used), a helmet ($4 used, though not sure a used helmet is ever a good purchase), and everything in my saddle bag (~$40 for the biking-specific stuff, all new, but you should always have this on hand), and everything else I borrowed from cyclist/triathlon friends. <strong>Find these friends</strong>. I cannot imagine doing this ride without a squeezable water bottle (don’t have to stop), a jersey (accessible pockets), arm warmers/jacket (it was 45F when we started), or shorts with chamois padding (take one ride, and you’ll understand). In fact, I’m thinking of buying all these after that ride. I also can’t imagine not having clips. While my friend was able to really pull on his clipless pedals, I just had the ability to grind away or bomb down hills without worrying my feet would fly off. You can add pedals on to a bike in about 10 minutes, so you can take them off when you’re going for a joyride.</p>
<p>The only item I would not have brought again was the earbuds. Talk to your friend! Listen to nature! Think!</p>
</section>
<section id="review" class="level2">
<h2 class="anchored" data-anchor-id="review">Review</h2>
<p><strong>This ride was a blast, and I think the route we chose was optimal for unsupported cyclists starting in New Haven</strong>. I spent considerable amounts of time riding without my hands, and that’s how it should be. We saw people out for morning jogs, elderly folk on their mid-day walks, ducks chilling in the water, and many people riding (though none of them passed us :D). Surprisingly, there are several bridges that rise 50ft above riverways and offer really cool views that I rarely get while biking.</p>
<p>As for the physical task of biking 100 miles, I couldn’t imagine it being easier. I felt as good at 95 miles as I did at 45 miles. In large part, I credit the flatness and the chamois protecting my nether regions, but I also have to think it was the prep. I almost passed out last spring after 45 miles, and I ended my century full.</p>
<p>I can totally see myself doing this again, though likely somehwere in Massachussetts! I loved the point-to-point and train aspect of this trip and want to find more routes that allow it, because it eliminates the hassle of driving to and from the end, the boredom of an out-and-back, and the danger of a loop route. On the other hand, I can’t see myself doing the Cape Cod route, because of the wind. We faced moderate wind throughout and it was very annoying.</p>
</section>
<section id="dos-and-donts" class="level2">
<h2 class="anchored" data-anchor-id="dos-and-donts">Dos and Don’ts</h2>
<p>Do * check your bike’s brake positioning, gears, and general operation before riding * bring clif bars and other sources of sugar * stop when you see something cool * refill whenever you see a fountain * be flexible and pick a great day (ours was sunny the whole day and the flowers were blooming) * apply sunscreen * take the train</p>
<p>Don’t * stress about water, there are plenty of fountains</p>


</section>


<div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>Check the schedules, because they very well may have changed; ours did two days before we had planned to go.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>